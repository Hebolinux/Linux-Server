## BIND服务

### bind主配置文件

示例：配置文件，原文注释已删除，做出修改的地方会在后面标记有注释

```shell
[root@harbor named]# vim /etc/named.conf
options {
        listen-on port 53 { 10.250.1.200; };	#将监听地址改为内网地址10.250.1.200
        listen-on-v6 port 53 { ::1; };			#监听IPv6地址的选项用不到可删除
        directory       "/var/named";
        dump-file       "/var/named/data/cache_dump.db";
        statistics-file "/var/named/data/named_stats.txt";
        memstatistics-file "/var/named/data/named_mem_stats.txt";
        recursing-file  "/var/named/data/named.recursing";
        secroots-file   "/var/named/data/named.secroots";
        allow-query     { any; };	#允许指定的客户端能够通过此DNS进行域名解析，原本为localhost
        forwarders		{ 10.250.1.254; };		#指定上一级DNS服务器的IP，本机无法解析的域名会交给上一级进行解析
        
        recursion yes;				#使用递归算法提供域名解析

        dnssec-enable no;			#这里要把yes改为no，否则解析失败
        dnssec-validation no;

        bindkeys-file "/etc/named.root.key";

        managed-keys-directory "/var/named/dynamic";

        pid-file "/run/named/named.pid";
        session-keyfile "/run/named/session.key";
};

logging {
        channel default_debug {
                file "data/named.run";
                severity dynamic;
        };
};

zone "." IN {
        type hint;
        file "named.ca";
};

include "/etc/named.rfc1912.zones";
include "/etc/named.root.key";
```

示例：正向解析配置文件

```shell
[root@harbor named]# cat /var/named/example.com.zone
$TTL 1D
@       IN SOA  harbor.example.com. root.harbor.example.com. (
                                        0       ; serial
                                        1D      ; refresh
                                        1H      ; retry
                                        1W      ; expire
                                        3H )    ; minimum
                NS      harbor.example.com.
harbor          A       10.250.1.200
docker1        A       10.250.1.15
docker2        A       10.250.1.16
docker3        A       10.250.1.17
docker4        A       10.250.1.18
etcd1          A       10.250.1.19
etcd2          A       10.250.1.20
etcd3          A       10.250.1.21
loadbase1      A       10.250.1.22
loadbase2      A       10.250.1.23
```

示例：检测dns服务是否运行正常

```shell
[root@harbor ~]# named-checkconf			#检查主配置文件语法是否正确
[root@harbor ~]# named-checkzone example.com.zone /var/named/example.com.zone	#检查解析文件语法是否正确
[root@harbor ~]# dig -t A docker1.example.com @10.250.1.200 +short		#测试dns服务解析
```

> 补充：配置bind服务过程中除了配置文件严格的语法格式，还需要注意文件所属用户和组