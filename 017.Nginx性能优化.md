# 017.Nginx性能优化

## 性能优化概述

基于Nginx的性能优化首先需要对系统和Nginx当前的运行状态做一个信息收集，例如了解当前系统的结构和瓶颈，了解当前系统运行的业务、服务，单个服务能够支撑多大并发、最高瓶颈是多少、支持多少qps（每秒查询率）的访问请求，通过一些系统监控工具和压力测试工具，获取当前系统架构能够承受多少的请求和并发，基于此数据做相应的性能评估和优化方向

其次需要了解业务模式，每一个性能优化的目的都是为业务提供服务，所以需要了解业务接口的类型、系统层次化的结构，比如电商网站的抢购模式，只会在某一段时间内流量突增、比如Nginx所代表的角色，是代理、动静分离还是后端服务，针对不同的场景提供不同的优化方向

最后需要考虑性能和安全的对比，性能与安全在一定程度上是对立的，安全检测严密会对性能产生影响，过度追求性能会导致安全隐患，所以设计防火墙功能时必须平衡好两者的关系

## 压力测试工具

在系统业务量没有增长前就需要做好相应准备，以防范业务量突增带来的接口压力，因此对于业务接口的压力测试就显得非常重要，在业务上线之前就需要先对业务接口进行请求和并发的测试。管理员需要对系统能够承受的压力有一个评估，然后通过工具检测系统是否能够满足对应压力的需求

1. 安装ab压力测试工具

```shell
yum install -y httpd-tools
```

2. ab压测工具的使用方式

```shell
ab -n 200 -c 2 http://127.0.0.1/
    -n：总的请求次数
    -c：并发请求数
    -k：是否开启长链接
```

3. 配置Nginx静态网站与tomcat动态网站环境

```shell

server {
    server_name ab.example.com;
    listen 80;
    location / {
        root /usr/local/nginx/html/;
        try_files $uri @java_page;
        index index.jsp index.html;
    }
    location @java_page {
        proxy_pass http://172.16.1.7:8080;
    }
}
echo "Nginx Ab Load" > /usr/local/nginx/html/test7.html
echo "Tomcat Ab Load" > /usr/share/tomcat/webapps/ROOT/test7.html
```

